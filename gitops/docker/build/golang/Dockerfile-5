# syntax=docker/dockerfile:1
# Step 1: build golang binary
FROM golang:1.19-alpine as builder
WORKDIR /opt/app
COPY . .
ENV GOPROXY https://goproxy.cn,direct
RUN CGO_ENABLE=0 GOOS=linux GOARCH=amd64 go build -o example

# Step 2: copy binary from step1
FROM alpine
WORKDIR /opt/app
COPY --from=builder /opt/app/example ./
CMD [ "/opt/app/example" ]
# 多阶段构建，使用alpine进一步压缩