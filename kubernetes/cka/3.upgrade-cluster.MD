
# 确定要升级到哪个版本（# master only）

```shell 
# CentOS
yum list --showduplicates kubeadm --disableexcludes=kubernetes 

# Ubuntu
apt update
apt-cache madison kubeadm


# 在列表中查找最新的 1.24 版本
# 它看起来应该是 1.24.x-0，其中 x 是最新的补丁版本
```

# 升级计划

```shell
# CentOS
yum install -y kubeadm-1.22.12 --disableexcludes=kubernetes

# Ubuntu 
apt-mark unhold kubeadm && \
apt-get update && apt-get install -y kubeadm=1.22.12-00 && \
apt-mark hold kubeadm

kubeadm version

kubeadm upgrade plan # master only

sudo kubeadm upgrade apply v1.22.12 # master only
sudo kubeadm upgrade node # node only

```

# 排空

```shell
kubectl cordon <nodename>
kubectl drain <nodename> --delete-emptydir-data --ignore-daemonsets --force
kubectl get node -owide
```

# 升级kubelet

```shell
# CentOS
yum install -y kubelet=1.22.12-00 kubectl=1.22.12-00 --disableexcludes=kubernetes

# Ubuntu
apt-mark unhold kubelet kubectl
apt-get install -y kubelet=1.22.12-00 kubectl=1.22.12-00
apt-mark hold kubelet kubectl

sudo systemctl daemon-reload
sudo systemctl restart kubelet
```

# 恢复节点

```shell
kubectl uncordon <nodename>
kubectl get node -owide
```